<!DOCTYPE html>
<html>
<head>
    <title>Cycling Friendly Eateries In Vancouver Area BC</title>
    <style>
        /* Set the size of the map */
        #map {
            height: 800px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h3>Cycling Friendly Eateries In Vancouver Area BC [TEST]</h3>
    
    <div id="map"></div>

    <script>
        // Function to initialize the map
        function initMap() {
            // Map options
            var options = {
                zoom: 12,
                center: {lat: 49.2608724, lng: -123.113952} // Default center of the map
            };

            // New map
            var map = new google.maps.Map(document.getElementById('map'), options);

            var data = [
                    // Headers (for simplicity, we're not including nested objects like 'coords' and 'additionalInfo')
                    ["name","lat","lng","description","address","phone","website","patio","group","fullmeal","rack"],
                    ["Dageraad Brewing",49.256172,-122.922122,"Small-batch artisan brewery","3191 Thunderbird Crescent #114, Burnaby","604-420-2050","dageraadbrewing.com","?","?","?","Y"],
                    ["Sanctuary Cafe",49.118706,-123.158662,"Popular with cyclists","13020 No 2 Rd #160, Richmond","604-340-6888","www.sanctuarycafeyvr.com","Y","Large","Y","Y"],
                    ["inBtwn Cafe",49.2751225271571,-123.133687298543,"Home-made sweet treats and savoury bites.","1625 Hornby St, Vancouver","604-568-0971","www.inbtwncafe.ca","N","Tiny","N","Meters"],
                    ["Tinhouse Brewing Co.",49.2520359257663,-122.732909446363,"Lounge and patio, on Traboulay Poco Trail","550 Sherling Pl #2140, Port Coquitlam","604-474-3434","tinhousebrewing.ca","Y","?","?","?"],
                    ["Red Truck",49.2686790807303,-123.096756897474,"Hearty BBQ, burgers, and all-day breakfast to satisfy","295 E 1st Ave, Vancouver","604-682-4733","redtruckbeer.com","N","Large","Y","?"],
                    ["Enroute Coffee",49.270969503575,-123.155404704318,"Coffee, bikes, accessories, and repairs","2205 W 1st Ave, Vancouver","604-423-9900","enroute.cc","Y","Medium","N","Y"],
                    ["Greenhorn Cafe",49.2866198765632,-123.133941303486,"Gourmet breakfast & lunch","994 Nicola St, Vancouver","604-428-2912","www.greenhorncafe.com","Y","Small","Y","Y"]                ];

            function convertArrayToObjects(data) {
                // Extract headers
                const headers = data[0];
                // Transform each row into an object
                const objects = data.slice(1).map(row => {
                        const obj = {};
                        row.forEach((value, index) => {
                            // For simplicity in this example, we directly assign values.
                            // In a more complex scenario, you could check the header name and format accordingly.
                            obj[headers[index]] = value;
                        });
                        // Example of restructuring into a more complex object similar to the provided example
                        return {
                            name: obj.name,
                            coords: { lat: obj.lat, lng: obj.lng },
                            description: obj.description,
                            additionalInfo: {
                                address: obj.address,
                                phone: obj.phone,
                                website: obj.website,
                                patio: obj.patio,
                                group: obj.group,
                                fullmeal: obj.fullmeal,
                                rack: obj.rack
                        }
                    };
                });
                return objects;
            }

            var locations = convertArrayToObjects(data);
            //console.log(locations);

            // Insert this snippet right after the locations array is defined and populated
            var featuredLocationIndex = Math.floor(Math.random() * (locations.length - 1)) + 1; // Select a random location index, adjusted for header row
            var featuredLocation = locations[featuredLocationIndex - 1]; // Adjust for header row offset in locations array
            
            // Create a function to display the featured location details
            function displayFeaturedLocation(location) {
                // Assuming there's an element with the ID 'featuredLocation' where you want to display the details.
                // Add an HTML element with this ID above your map in the HTML body if it doesn't already exist.
                var featuredLocationDiv = document.createElement('div');
                featuredLocationDiv.id = 'featuredLocation';
                featuredLocationDiv.style.padding = '10px';
                featuredLocationDiv.style.marginBottom = '10px';
                featuredLocationDiv.style.border = '1px solid #ddd';
                featuredLocationDiv.style.backgroundColor = '#f9f9f9';
                
                var content = `<h4>Featured Location: ${location.name}, ${location.description}, ${location.additionalInfo.address}</h4>`;
                featuredLocationDiv.innerHTML = content;
                
                document.body.insertBefore(featuredLocationDiv, document.getElementById('map'));
            }

            // Call the function to display the featured location's details
            displayFeaturedLocation(featuredLocation);


            // Loop through locations and add markers
            locations.forEach(function(location) {
                console.log(location);
                addMarker(location);
            });

            // Function to add marker for a location

            function addMarker(location) {
                var marker = new google.maps.Marker({
                    position: location.coords,
                    map: map,
                    title: location.name,
                    // Specify the custom icon here
                    icon: {
                        url: 'cycle_food.png', // Path to custom icon image
                        // Optionally, you can specify the icon size and origin
                        scaledSize: new google.maps.Size(24, 24), // Scaled size (width, height)
                        origin: new google.maps.Point(0, 0), // Origin (x, y)
                        anchor: new google.maps.Point(12, 12) // Anchor (x, y)
                    }
                });

                if (location.description || location.additionalInfo) {
                    let infoContent = `<p><strong>${location.name}</strong><br>`;
                    
                    if (location.description) {
                        infoContent += `${location.description}<br>`;
                    }
                    
                    if (location.additionalInfo) {
                        const { address, phone, website, patio, group, fullmeal, rack } = location.additionalInfo;
                        infoContent += `Address: ${address}<br>`;
                        infoContent += `Phone: <a href="tel:${phone}">${phone}</a><br>`;
                        infoContent += `Website: <a href="${website}" target="_blank">${website}</a><br>`;
                        infoContent += `Patio:${patio} Group Size:${group} Full Meal:${fullmeal} Rack:${rack}`;
                        infoContent += `</p>`;
                    }

                    var infoWindow = new google.maps.InfoWindow({
                        content: infoContent
                    });

                    marker.addListener('click', function() {
                        infoWindow.open(map, marker);
                    });
                }
            }


            function addMarker0(location) {
                var marker = new google.maps.Marker({
                    position: location.coords,
                    map: map,
                    title: location.name,
                    // Specify the custom icon here
                    icon: {
                        url: 'cycle_food.png', // Path to custom icon image
                        // Optionally, you can specify the icon size and origin
                        scaledSize: new google.maps.Size(20, 20), // Scaled size (width, height)
                        origin: new google.maps.Point(0, 0), // Origin (x, y)
                        anchor: new google.maps.Point(10, 10) // Anchor (x, y)
                    }
                });

                // Check for a description and add info window
                if (location.description) {
                    var infoWindow = new google.maps.InfoWindow({
                        content: `<h4>${location.name}</h4><p>${location.description}</p>`
                    });

                    marker.addListener('click', function() {
                        infoWindow.open(map, marker);
                    });
                }
            }
        }
    </script>

    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZmQ7dDmii8uuDNwWWXKXWyeJsQsZ3JmY&callback=initMap">
    </script>
</body>
</html>
